!function(){"use strict";String.prototype.camelCaseToNormalText=function(){return this.replace(/([A-Z])/g," $1").replace(/^./,function(a){return a.toUpperCase()})},angular.module("uiTreeGrid",[]),angular.module("uiTreeGrid").value("uiGridConfig",{}),angular.module("uiTreeGrid").directive("uiGrid",["uiGridConfig","Util",function(a,b){var c={};return a&&angular.extend(c,a),{restrict:"A",replace:!0,templateUrl:"grid.html",scope:!0,link:function(a,c,d){a.columns=a.$eval(d.columns),a.data=a.$eval(d.data),a.searchText=a.$eval(d.searchText),a.selectRow=a.$eval(d.selectRow),a.controller=a.$eval(d.controller),a.childrenNode=d.childrenNode||"children",a.fixedHeader=d.fixedHeader,a.iconTemplate=d.iconTemplate,a.treeData=[],a.predicate="",a.reverse=!1,a.fixedHeader&&angular.element(c).bind("scroll",function(b){this.querySelector(".tg-header").style.top=b.target.scrollTop+"px",a.$apply()}),b.isEmpty(a.data.$promise)&&(a.data.$promise={then:function(b){b(a.data)}}),b.isEmpty(a.columns)&&a.data.$promise.then(function(c){a.columns=b.generateColumnsByData(c,a.childrenNode)}),a.data.$promise.then(function(c){a.treeData=b.generate(b.sort(c,a.predicate,a.reverse),1)}),a.sort=function(c,d){a.predicate=c,a.reverse=!d,a.treeData=b.generate(b.sort(a.data,a.predicate,a.reverse),1)},a.isVisibleIcon=function(c){return c>0?!1:!b.isUndefined(a.iconTemplate)},a.clickRow=function(c,d){return b.isEmpty(a.selectRow)?!1:void a.selectRow(c,d)},a.$watch("searchText",function(c){a.treeData=[];var d=b.filter(a.data,c),e=b.sort(d,a.predicate,a.reverse);a.treeData=b.generate(e,1)}),a.$watch("data",function(c,d){var e=_.difference(_.pluck(c,"id"),_.pluck(d,"id"));e.length>0&&(c.forEach(function(a){a.change=!1}),e.forEach(function(a){_.find(c,{id:a}).change=!0})),a.treeData=[],a.treeData=b.generate(c)},!0),c.find("div").eq(1).bind("scroll",function(){c.find("div").eq(0).css("left",-1*this.scrollLeft+"px")}),d.$observe("iconTemplate",function(b){a.iconTemplate=b})}}}]).directive("uiCell",["Util","$filter",function(a,b){var c=function(c){var d=c.column,e=c.row;c.hasHtml=!1;var f=a.deepFind(e,d.id);switch(d.format){case"date":f=b("date")(f);break;case"currency":f=b("currency")(f);break;case"file":c.hasHtml=!0,f=b("convertFile")(f);break;case"tree":c.hasHtml=!0,f=b("convertTree")(f)}c.value=f};return{restrict:"A",replace:!0,templateUrl:"cell.html",transclude:!0,scope:{column:"=",row:"="},link:c}}]).filter("convertFile",["$sce",function(a){return function(b){return a.trustAsHtml('<a href="/service/download/:id" target="_blank" class="btn btn-primary btn-icon"><i class="fa fa-cloud-download"></i></a>'.replace(":id",b))}}]).filter("convertTree",["$sce",function(a){return function(b){function c(a){d.unshift('<li class="tg-tree-list-item">'+a.label+"</li>"),a.parent?c(a.parent):d[d.length-1]=d[d.length-1].replace("tg-tree-list-item","tg-tree-list-item mult-select-tree-last")}var d=[],e="";return c(b),e='<ul class="tg-tree-list tg-tree-list__readonly">'+d.join("")+"</ul>",a.trustAsHtml(e)}}]),angular.module("uiTreeGrid").service("Util",["$filter",function(a){var b=this;this.isUndefined=function(a){return"undefined"==typeof a},this.isEmpty=function(a){return"undefined"==typeof a||null===a||""===a},["Arguments","Function","String","Number","Date","RegExp","Object"].forEach(function(a){b["is"+a]=function(b){return toString.call(b)==="[object "+a+"]"}}),this.generate=function c(a,b,d){d=d||[],b=b||1;var e=angular.copy(a);return(e||[]).forEach(function(a){a.lvl=b,d.push(a),c(a.children,b+1,d),delete a.children}),d},this.filter=function d(b,c){var e=angular.copy(b);return(e||[]).forEach(function(a){a.children=d(a.children,c)}),a("filter")(e,c)},this.sort=function e(b,c,d){var f=angular.copy(b);return(f||[]).forEach(function(a){a.children=e(a.children,c,d)}),a("orderBy")(f,c,d)},this.generateColumnsByData=function(a,b){var c=[];return Object.keys(a[0]).forEach(function(a){return a===b?!1:void c.push({id:a,label:a.camelCaseToNormalText()})}),c},this.deepFind=function(a,b){var c;try{c=this.deep(a,b)}catch(d){}return c},this.deep=function(a,b,c){var d,e=b.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").split("."),f=0,g=e.length;if(arguments.length>2){for(d=a,g--;g>f;)b=e[f++],a=a[b]=this.isObject(a[b])?a[b]:{};a[e[f]]=c,c=d}else{for(var h=!0;h&&g>f;)h=null!==(a=a[e[f++]]);c=g>f?void 0:a}return c}}]),angular.module("uiTreeGrid").run(["$templateCache",function(a){a.put("cell.html","<div ng-class=\"{true: 'tg-not-wrap-text', false: ''}[hasHtml]\"><span ng-transclude></span> <span ng-bind=value ng-if=!hasHtml></span> <span ng-bind-html=value ng-if=hasHtml></span></div>"),a.put("grid.html",'<div class="ui-tree-grid bordered"><div class=tg-content-table><div class="tg-header tg-row"><div class="tg-column tg-size-{{column.size||3}}" ng-repeat="column in columns" ng-click="sort(column.id, reverse);">{{column.label}} <span ng-class="{true: \'fa fa-sort-asc\', false: \'fa fa-sort-desc\'}[reverse]" ng-if="column.id == predicate"></span></div></div><div class=tg-body><div ng-repeat="row in treeData" class=tg-row ng-class="{true: \'tg-animate-included\'}[row.change]"><div ui-cell="" column=column row=row class="tg-column tg-lvl-{{row.lvl}} tg-size-{{column.size||3}}" ng-repeat="column in columns" ng-click="clickRow(row, $index);"><span ng-if=isVisibleIcon($index) class=icon-template ng-include=iconTemplate></span></div></div></div></div></div>')}])}(window);